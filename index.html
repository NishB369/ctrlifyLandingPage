<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link href="./src/output.css" rel="stylesheet" />
    <link rel="stylesheet" href="./style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Chakra+Petch:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Xanh+Mono:ital@0;1&display=swap"
      rel="stylesheet"
    />
    <style>
      html.lenis,
      html.lenis body {
        height: auto;
      }

      .lenis.lenis-smooth {
        scroll-behavior: auto !important;
      }

      .lenis.lenis-smooth [data-lenis-prevent] {
        overscroll-behavior: contain;
      }

      .lenis.lenis-stopped {
        overflow: hidden;
      }

      .lenis.lenis-smooth iframe {
        pointer-events: none;
      }
    </style>
  </head>

  <body>
    <div class="px-20 py-4">
      <div
        style="
          background-image: url(./public/media/images/GridLines.png);
          background-position: center;
          background-size: cover;
        "
        class="h-[100vh] w-[100vw] absolute top-0 left-0 overflow-x-hidden"
      ></div>

      <div
        class="bg-[#121826] w-full py-2 rounded-full px-4 flex items-center justify-between text-white sticky top-4 z-20"
      >
        <img src="./public/media/images/Logo.png" class="w-20 cursor-pointer" />
        <div class="flex items-center justify-between gap-20">
          <div class="cursor-pointer">Why</div>
          <div class="cursor-pointer">Features</div>
          <div class="cursor-pointer">Demo</div>
        </div>
        <button
          class="text-[#121826] font-semibold px-4 py-2 rounded-full cursor-pointer"
          style="
            background: radial-gradient(
              circle at 0% 0%,
              #fff600,
              #ffd900,
              #ffd900,
              #ffd900,
              #ffa900
            );
          "
        >
          Get Started
        </button>
      </div>

      <div
        class="h-[510px] mt-4 pt-6 flex flex-col items-center justify-center text-[#121826] relative"
      >
        <div
          class="w-[100vw] h-[12.5%] absolute bottom-0 z-10"
          style="
            background: linear-gradient(
              180deg,
              rgba(255, 255, 255, 0) 0%,
              #0171ff 250%
            );
          "
        ></div>

        <div class="text-center">
          <div
            class="text-7xl font-black tracking-wider"
            style="font-family: agrandir-glight"
          >
            Financial
          </div>
          <div
            class="flex items-center justify-center font-semibold text-6xl -mt-2 gap-2 tracking-wide"
          >
            <div>Chaos</div>
            <div class="bg-[#0171ff] px-10 py-2 rounded-full">
              <img src="./public/media/images/RightArrow.png" class="w-20" />
            </div>
            <div>Ctrl</div>
          </div>
        </div>

        <div class="flex items-center justify-between gap-2 mt-4">
          <button
            class="text-[#121826] font-semibold px-6 py-2 rounded-sm border-2 cursor-pointer"
            style="
              background: radial-gradient(
                circle at 0% 0%,
                #fff600,
                #ffd900,
                #ffd900,
                #ffd900,
                #ffa900
              );
            "
          >
            Get Started
          </button>
          <button
            class="text-white font-semibold px-6 py-2 border-2 border-black rounded-sm cursor-pointer bg-[#121826]"
          >
            Watch Demo
          </button>
        </div>

        <div class="overflow-hidden px-60 mt-6 relative">
          <img
            src="./public/media/images/BalanceImg.png"
            class="w-60 absolute left-20 top-12"
          />
          <img
            src="./public/media/images/ChartImg.png"
            class="w-50 absolute top-20 right-24"
          />
          <img
            src="./public/media/images/RsCoin.png"
            class="w-30 absolute right-44"
          />
          <img src="./public/media/images/MainPhone.png" class="w-96" />
        </div>
      </div>
      <div class="py-20 px-30 flex items-center justify-center gap-16">
        <div class="w-1/2 flex flex-col gap-4">
          <div class="text-6xl font-semibold">Why Ctrilfy?</div>
          <div class="text-xl">
            Drowning in scattered income, missed expenses, and forgotten savings
            goals?
          </div>

          <div class="flex flex-col gap-2">
            <div class="w-full flex justify-end">
              <div
                class="bg-[#121826] border-[#121826] border-2 flex items-center justify-center text-white py-2 rounded-md w-[65%] font-semibold text-xl leading-6"
              >
                <div class="w-3/4">No single place to manage everything</div>
              </div>
            </div>

            <div class="w-full flex">
              <div
                class="bg-[#0171ff] border-[#121826] border-2 flex items-center justify-center text-white py-2 rounded-md w-[65%] font-semibold text-xl leading-6"
              >
                <div class="w-3/4">Unclear where your money goes</div>
              </div>
            </div>

            <div class="w-full flex justify-end">
              <div
                class="bg-[#121826] border-[#121826] border-2 flex items-center justify-center text-white py-2 rounded-md w-[65%] font-semibold text-xl leading-6"
              >
                <div class="w-3/4">Unable to invest money in savings</div>
              </div>
            </div>

            <div class="w-full flex">
              <div
                class="bg-[#0171ff] border-[#121826] border-2 flex items-center justify-center text-white py-2 rounded-md w-[65%] font-semibold text-xl leading-6"
              >
                <div class="w-3/4">Overwhelmed by financial chaos</div>
              </div>
            </div>
          </div>
        </div>

        <div class="w-1/2">
          <video
            src="./public/media/videos/FlyingMoneyCard.mp4"
            autoplay
            muted
            loop
            class="rounded-sm"
          ></video>
        </div>
      </div>
    </div>

    <div class="relative w-full h-[1500vh]">
      <div class="w-full sticky top-0 left-0 overflow-hidden">
        <canvas class="w-full h-screen" id="canvas"></canvas>
      </div>
    </div>

    <div class="px-20 pt-20 relative overflow-hidden">
      <div class="w-full flex flex-col items-center justify-center">
        <div
          class="text-5xl font-semibold text-[#121826] text-center leading-12 w-3/4"
          style="font-family: agrandir-textbold"
        >
          Watch <span class="text-[#0171ff] italic">Ctrilfy</span> Transform
          Your Finances Are Saying
        </div> 
        
        <div id="parent" class="bg-[#0171ff] p-20 w-full h-[50vh] mt-40 rounded-t-[100px] border-2 relative flex justify-center">
          <video id="demoVid" src="./public/media/videos/Demo.mp4" class="rounded-[40px] border-2 border-black absolute scale-85 -top-30" autoplay muted loop></video>
        </div>
      </div>
      </div>
    </div>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"
      integrity="sha512-7eHRwcbYkK4d9g/6tD/mhkf++eoTHwpNM9woBxtPUBWm67zeAfFC+HrdoE2GanKeocly/VxeLvIqwvCdk7qScg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"
      integrity="sha512-onMTRKJBKz8M1TnqqDuGBlowlH0ohFzMXYRNebz+yOcc5TQr/zAKsthzhuv0hiyUKEiQEQXEynnXCvNTOk50dg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script src="https://unpkg.com/lenis@1.1.13/dist/lenis.min.js"></script>

    <script>
      const canvas = document.querySelector("#canvas");
      const context = canvas.getContext("2d");
      const frames = {
        currentIndex: 1,
        maxIndex: 372,
      };

      const images = [];
      let imagesLoaded = 0;
      let audioStarted = false;

      function preloadImages() {
        for (var i = 1; i <= frames.maxIndex; i++) {
          const imageUrl = `/Frames/frame_${i
            .toString()
            .padStart(4, "0")}.jpeg`;
          const img = new Image();
          img.src = imageUrl;

          img.onload = function () {
            imagesLoaded++;
            if (imagesLoaded === frames.maxIndex) {
              loadImage(frames.currentIndex);
              startAnimation();
            }
          };

          images.push(img);
          console.log(imagesLoaded);
        }
      }

      function loadImage(index) {
        if (index >= 0 && index <= frames.maxIndex) {
          const img = images[index];

          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;

          const scaleX = canvas.width / img.width;
          const scaleY = canvas.height / img.height;
          const scale = Math.max(scaleX, scaleY);

          const newWidth = img.width * scale;
          const newHeight = img.height * scale;

          const offsetX = (canvas.width - newWidth) / 2;
          const offsetY = (canvas.height - newHeight) / 2;

          context.clearRect(0, 0, canvas.width, canvas.height);
          context.imageSmoothingEnabled = true;
          context.imageSmoothingQuality = "high";
          context.drawImage(img, offsetX, offsetY, newWidth, newHeight);

          frames.currentIndex = index;
        }
      }

      function startAnimation() {
        var tl = gsap.timeline({
          scrollTrigger: {
            trigger: ".parent",
            start: "top top",
            scrub: 2,
            end: "bottom bottom",
          },
        });

        function updateFrame(index) {
          return {
            currentIndex: index,
            ease: "linear",
            onUpdate: function () {
              loadImage(Math.floor(frames.currentIndex));
            },
          };
        }

        tl.to(frames, updateFrame(70), "a")

          .to(frames, updateFrame(140), "b")
          .to("canvas", { scale: 0.5, ease: "linear " }, "b")

          .to(frames, updateFrame(372), "c")
          .to("canvas", { scale: 1, ease: "linear " }, "c");
      }

      window.addEventListener("resize", function () {
        loadImage(Math.floor(frames.currentIndex));
      });

      const lenis = new Lenis();

      function raf(time) {
        lenis.raf(time);
        requestAnimationFrame(raf);
      }

      requestAnimationFrame(raf);

      preloadImages();

      // Replace the existing demoVid animation code block with this:
const demoVid = document.querySelector("#demoVid");

// First, enable 3D transformations
gsap.set("#parent", {
  perspective: 1000 
});

gsap.set(demoVid, {
  scale: 2,
  rotationX: 60, 
  transformOrigin: "center top",
  
});

gsap.to(demoVid, {
  scrollTrigger: {
    trigger: "#parent",
    start: "top bottom", 
    end: "top center", 
    scrub:4,
    markers: false, 
    toggleActions: "play none none reverse"
  },
  scale: 0.75,
  rotationX: 0, 
 
});

    </script>
  </body>
</html>
